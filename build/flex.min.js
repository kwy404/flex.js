/*! flex 2023-04-03 */
class Flex{constructor({el:t="html",state:e={},methods:r={}}){this.parse=new parse_,this.el=t,this.state=this.createStateProxy(e),this.elements=Array.from(document.querySelectorAll(this.el+" *")).filter(t=>t.childNodes.length&&/\S/.test(t.textContent)),this.cloneNode=new html_parse_(this.el),this.start_app(),this.methods_({methods:r})}createStateProxy(t){return new Proxy(t,{set:(t,e,r)=>(t[e]=r,this.updateElements(e),!0)})}start_app(){this.elements.forEach((e,t)=>{var r;e.nodeType===Node.TEXT_NODE?(r=this.parse.text(e.textContent))&&r.forEach(t=>{t.key&&(e.textContent=e.textContent.replace(t.text,this.state[t.key]))}):Array.from(e.childNodes).forEach(e=>{var t;e.nodeType===Node.TEXT_NODE&&(t=this.parse.text(e.textContent))&&t.forEach(t=>{t.key&&(e.textContent=e.textContent.replace(t.text,this.state[t.key]))})})})}updateElements(t){const e=document.querySelectorAll(this.el+" *");var r=this.cloneNode.cloneNode(!0);Array.from(r.querySelectorAll("*")).forEach((t,r)=>{const n=e[r];if(t.nodeType===Node.TEXT_NODE){r=this.parse.text(t.textContent);if(r){let e=t.textContent;r.forEach(t=>{t.key&&(e=e.replace(t.text,this.state[t.key]))}),n.textContent=e}}else Array.from(t.childNodes).forEach((t,r)=>{if(t.nodeType===Node.TEXT_NODE){var o=this.parse.text(t.textContent);if(o){let e=t.textContent;o.forEach(t=>{t.key&&(e=e.replace(t.text,this.state[t.key]))}),n.childNodes[r].textContent=e}}})})}methods_({methods:l}){const c=Array.from(document.querySelectorAll(this.el+" *"));var t=Array.from(document.querySelectorAll(this.el+" > *"));const h=this;t.forEach((e,r)=>{var o=e.attributes;for(let t=0;t<o.length;t++){var n=o[t].name,s=n.replace(":","");if(n&&":"===n[0]){const a=e.getAttribute(n);c[r].addEventListener(s,function(){"function"==typeof l[a]&&l[a].call(h)}),e.removeAttribute(n)}}}),Array.from(document.querySelectorAll(this.el+" [f-each]")).forEach(n=>{const[s,t]=n.getAttribute("f-each").split(" in "),a=h.state[t];if(a){const l=document.createDocumentFragment();a.forEach((t,e)=>{var r=n.cloneNode(!0),o=(r.removeAttribute("f-each"),r.querySelector("*"));o&&(o.textContent=t[s]),r.textContent=a[e],l.appendChild(r)}),n.parentNode.replaceChild(l,n)}}),Array.from(document.querySelectorAll(this.el+" *[f-text]")).forEach(t=>{var e=t.getAttribute("f-text");t.textContent=h.state[e]})}}function html_parse_(t){return document.querySelectorAll(t)[0].cloneNode(!0)}function parse_(){var n=/\{\{(.+?)\}\}/;return{text:function(t){if(!n.test(t))return null;for(var e,r,o=[];e=t.match(n);)0<(r=e.index)&&o.push(t.slice(0,r)),o.push({text:e[0],key:e[1].trim()}),t=t.slice(r+e[0].length);return t.length&&o.push(t),o}}}