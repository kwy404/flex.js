/*! flex 2023-04-03 */
class Flex{constructor({el:e="html",state:t={},methods:o={}}){this.parse=new parse_,this.el=e,this.state=this.createStateProxy(t),this.elements=this.getNonEmptyChildElements(),this.cloneNode=new html_parse_(this.el),this.start_app(),this.methods_({methods:o})}createStateProxy(e){return new Proxy(e,{set:(e,t,o)=>(e[t]=o,this.updateElements(t),!0)})}getNonEmptyChildElements(){return Array.from(document.querySelectorAll(this.el+" *")).filter(e=>{return e.nodeType===Node.TEXT_NODE?/\S/.test(e.textContent):Array.from(e.childNodes).some(e=>e.nodeType===Node.TEXT_NODE?/\S/.test(e.textContent):e.nodeType===Node.ELEMENT_NODE?e.childNodes.length&&e.childNodes.some(e=>e.nodeType===Node.TEXT_NODE&&/\S/.test(e.textContent)):void 0)})}getNonEmptyChildElementsRecursively(e){return Array.from(e.childNodes).filter(e=>!(e.nodeType!==Node.TEXT_NODE||!/\S/.test(e.textContent))||e.nodeType===Node.ELEMENT_NODE&&0<this.getNonEmptyChildElementsRecursively(e).length)}start_app(){console.log(this.elements),this.elements.forEach((t,e)=>{var o;t.nodeType===Node.TEXT_NODE?(o=this.parse.text(t.textContent))&&o.forEach(e=>{e.key&&(t.textContent=t.textContent.replace(e.text,this.state[e.key]))}):Array.from(t.childNodes).forEach(t=>{var e;t.nodeType===Node.TEXT_NODE&&(e=this.parse.text(t.textContent))&&e.forEach(e=>{e.key&&(t.textContent=t.textContent.replace(e.text,this.state[e.key]))})})})}updateElements(e){const t=document.querySelectorAll(this.el+" *");var o=this.cloneNode.cloneNode(!0);Array.from(o.querySelectorAll("*")).forEach((e,o)=>{const n=t[o];if(e.nodeType===Node.TEXT_NODE){o=this.parse.text(e.textContent);if(o){let t=e.textContent;o.forEach(e=>{e.key&&(t=t.replace(e.text,this.state[e.key]))}),n.textContent=t}}else Array.from(e.childNodes).forEach((e,o)=>{if(e.nodeType===Node.TEXT_NODE){var r=this.parse.text(e.textContent);if(r){let t=e.textContent;r.forEach(e=>{e.key&&(t=t.replace(e.text,this.state[e.key]))}),n.childNodes[o].textContent=t}}})})}methods_({methods:h}){const i=Array.from(document.querySelectorAll(this.el+" *"));var e=Array.from(document.querySelectorAll(this.el+" > *"));const a=this;e.forEach((t,o)=>{var r=t.attributes;for(let e=0;e<r.length;e++){var n=r[e].name,s=n.replace(":","");if(n&&":"===n[0]){const l=t.getAttribute(n);i[o].addEventListener(s,function(){"function"==typeof h[l]&&h[l].call(a)}),t.removeAttribute(n),t.cloneNode(!0)}}})}}function html_parse_(e){return document.querySelectorAll(e)[0].cloneNode(!0)}function parse_(){var n=/\{\{(.+?)\}\}/;return{text:function(e){if(!n.test(e))return null;for(var t,o,r=[];t=e.match(n);)0<(o=t.index)&&r.push(e.slice(0,o)),r.push({text:t[0],key:t[1].trim()}),e=e.slice(o+t[0].length);return e.length&&r.push(e),r}}}